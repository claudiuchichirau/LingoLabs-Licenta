@page "/lesson-dashboard"
@using LingoLabs.App.ViewModel.MudBlazor
@using MudBlazor
@using MatBlazor
@using System.Net.Http.Json
@using ViewModel.MudBlazor
@inject NavigationManager NavigationManager
@inject HttpClient httpClient
@inject ISnackbar Snackbar
@inject IDialogService DialogService


<div class="d-flex justify-content-around bg-secondary mb-3 align-items-center" style="width: 100%; height: 250px; margin-top: -10px; background: linear-gradient(to right, #2563EB, #36A7FC); position: relative; z-index: 1;">
    @foreach (string tag in lesson.LessonTags)
    {
        Random random = new Random();
        <span style="color: #CDE9FE; position: absolute; top: @(new Random().Next(10, 90))%; left: @(new Random().Next(10, 90))%; font-size: @(random.Next(10, 30))px; transform: rotate(@(random.Next(-15, 15))deg);">@tag</span>
    })
</div>

@* GET BY ID INFORMATIONS *@
<MudContainer>
    <div class="row mx-0 justify-content-md-center" style="margin-top: -175px; margin-bottom: 40px;">
        <div class="col-md-6 d-flex flex-column align-items-center justify-content-center" style="background-color: #E9EFFD; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); z-index: 1; border-radius: 15px;">
            <div class="row">
                <h1 style="color: #2563EB; padding: 20px; margin-top: 10px;" class="poppins-semi-bold">@lesson.LessonTitle</h1>
            </div>
        </div>
    </div>

    <div class="row mx-0 justify-content-between">
        <div class="col-md-3 d-flex flex-column align-items-center justify-content-center" style="background-color: #E9EFFD; box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.5); z-index: 1; border-radius: 15px;">
            <div class="row">
                @* <span style="color: #FC6F05; padding: 3px; font-size: 20px;" class="poppins-semi-bold">@lesson.ChapterId</span> *@
                <span style="color: #FC6F05; padding: 3px; font-size: 20px;" class="poppins-semi-bold">Chapter 1</span>
            </div>
        </div>
        <div class="col-md-3 d-flex flex-column align-items-center justify-content-center" style="background-color: #E9EFFD; box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.5); z-index: 1; border-radius: 15px;">
            <div class="row">
                @* <span style="color: #fc6f05; padding: 3px; font-size: 20px;" class="poppins-semi-bold">@lesson.LanguageCompetenceId</span> *@
                <span style="color: #FC6F05; padding: 3px; font-size: 20px;" class="poppins-semi-bold">Grammar</span>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(lesson.LessonDescription))
    {
        <div class="row" style="margin-top: 70px; margin-bottom: 70px;">
            <div class="col">
                <div class="text-center" style="display: flex; flex-direction: column; justify-content: center; height: 100%;">
                    <p style="color: black; font-size: 22px;" class="poppins-semi-bold">@lesson.LessonDescription</p>
                </div>
            </div>
        </div>
    }

    @if (!string.IsNullOrEmpty(lesson.LessonVideoLink))
    {
        <div class="row" style="margin-top: 45px; margin-bottom: 10px;">
            <div class="col">
                <div class="text-center" style="display: flex; flex-direction: column; justify-content: center; height: 100%;">
                    <p class="custom-text" style="font-size: 40px; margin-bottom: -3px;">
                        <span style="color: #FC6F05;"><strong>Hear</strong></span>,
                        <span style="color: #2563EB;"><strong>understand</strong></span>,
                        <span style="color: lawngreen;"><strong>express</strong></span>
                    </p>
                    <p style="font-size: 22px;">Right here, right now, we’ve got a video that’ll tie up all the loose ends of this lesson, giving you the scoop on everything you need to know. Let’s dive in! 😊</p>
                </div>
            </div>
        </div>

        <div class="row" style="margin-bottom: 70px;">
            <div class="col text-center">
                <iframe style="width: 700px; height: 394px; margin-top: 9px;" src="@lesson.LessonVideoLink" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    }

    @if (!string.IsNullOrEmpty(lesson.LessonContent))
    {
        <div class="row" style="margin-top: 70px; margin-bottom: 70px;">
            <div class="col">
                <div class="text-center" style="display: flex; flex-direction: column; justify-content: center; height: 100%;">
                    <p style="color: black; font-size: 22px;" class="poppins-semi-bold">@lesson.LessonContent</p>
                </div>
            </div>
        </div>
    }

    @if (!string.IsNullOrEmpty(lesson.LessonImageLink))
    {
        <div class="row" style="margin-top: 70px; margin-bottom: 150px;">
            <div class="d-flex justify-content-center align-items-center" style="height: 100%;">
                <img src="@lesson.LessonImageLink" style="max-width: 700px; height: auto;">
            </div>
        </div>
    }

    <div class="text-center" style="margin-bottom: 50px;">
        <h1 style="color: black; font-size: 33px; margin-top: 80px; margin-bottom: 15px;">
            Time for a <span style="color: #FC6F05;">Quiz</span>
        </h1>
        <h2 style="font-size: 19px; margin-bottom: 30px;">
            Get ready to test your knowledge with our comprehensive quiz. Spanning a minimum of 10 questions, each designed to challenge and enhance your understanding of the lesson. Good luck!
        </h2>
        <MudButton Variant="Variant.Filled" OnClick="StartQuiz" Color="Color.Primary" Style="background-color: #FC6F05; color: white; padding: 10px;"><MudIcon Icon="@Icons.Material.Filled.Quiz"></MudIcon> START NOW!</MudButton>
    </div>
</MudContainer>


@code {
    private LessonElement lesson = new LessonElement();

    protected override async Task OnInitializedAsync()
    {
        await PopulateLesson();
    }

    private async Task PopulateLesson()
    {
        lesson = new LessonElement
            {
                LessonId = Guid.NewGuid(),
                ChapterId = Guid.NewGuid(),
                LanguageCompetenceId = Guid.NewGuid(),
                LessonTitle = "Introduction in English",
                LessonDescription = "Welcome to the first lesson of our English language course. This introductory session is designed to ease you into the world of English, starting from the very basics. We'll explore the building blocks of the language, ensuring a solid foundation for your linguistic journey.",
                LessonContent = "Hello and a warm welcome! I hope you're excited to embark on this adventure into the English language. Today, we'll begin with the alphabet, delving into the sounds and pronunciations of each letter. Understanding these fundamentals is crucial as they form the backbone of English communication. \n\nWe'll then transition to basic vocabulary, introducing you to essential words that will be your tools for constructing simple sentences. By the end of this lesson, you'll have a grasp of key phrases and the confidence to use them in everyday conversations.\n\nLet's dive in and start our path to mastering English!",
                LessonVideoLink = "https://www.youtube.com/embed/1y6smkh6c-0",
                LessonImageLink = "https://psenglish.co.uk/wp-content/uploads/2021/11/Do-you-speak-English.jpg",
                LessonTags = new List<string> { "English", "Beginner", "Alphabet", "Vocabulary", "Pronunciation", "Communication", "Conversation" },
                LessonRequirement = "In the next minutes you will take a quiz to test your knowledge about the alphabet and basic vocabulary.",
                Questions = new List<QuestionElement>
            {
                new QuestionElement
                {
                    QuestionId = Guid.NewGuid(),
                    QuestionRequirement = "What is the first letter of the English alphabet?",
                    QuestionType = QuestionTypeElement.Grila,
                    QuestionChoices = new List<ChoiceElement>
                    {
                        new ChoiceElement
                        {
                            ChoiceId = Guid.NewGuid(),
                            ChoiceContent = "A",
                            IsCorrect = true
                        },
                        new ChoiceElement
                        {
                            ChoiceId = Guid.NewGuid(),
                            ChoiceContent = "B",
                            IsCorrect = false
                        },
                        new ChoiceElement
                        {
                            ChoiceId = Guid.NewGuid(),
                            ChoiceContent = "C",
                            IsCorrect = false
                        },
                        new ChoiceElement
                        {
                            ChoiceId = Guid.NewGuid(),
                            ChoiceContent = "D",
                            IsCorrect = false
                        }
                    }
                },
                new QuestionElement
                {
                    QuestionId = Guid.NewGuid(),
                    QuestionRequirement = "<Apple> is a verb?",
                    QuestionType = QuestionTypeElement.TrueFalse,
                    QuestionChoices = new List<ChoiceElement>
                    {
                        new ChoiceElement
                        {
                            ChoiceId = Guid.NewGuid(),
                            ChoiceContent = "Apple",
                            IsCorrect = false
                        }
                    }
                },
                new QuestionElement
                {
                    QuestionId = Guid.NewGuid(),
                    QuestionRequirement = "The solar system has ____ planets.",
                    QuestionType = QuestionTypeElement.CuvantLipsa,
                    QuestionChoices = new List<ChoiceElement>
                    {
                        new ChoiceElement
                        {
                            ChoiceId = Guid.NewGuid(),
                            ChoiceContent = "8",
                            IsCorrect = false
                        },
                    }
                }
            }
            };
    }

    void StartQuiz()
    {
        NavigationManager.NavigateTo("/quiz");
    }
}